---
---
[
{%- for page in site.html_pages -%}
    {%- unless page.exclude -%}
        {%- assign page_url = page.url -%}
        {%- assign split_content = page.content | markdownify | split: '<h2' | splice: 1  -%}
        
{%- comment -%}Deal with h1 section{%- endcomment -%}
{%- assign page_header = split_content.first | split: '>' -%}
{%- assign page_header = page_header[1] | split: '</h1' -%}
{%- assign page_header = page_header[0] -%}
{%- assign header_section = '<h1' | append: split_content.first  | strip_html | newline_to_br | strip_newlines | replace: '<br />', ' ' | strip | jsonify -%}
{
"title": "{{ page_header}}",
"url": "{{page_url}}",
"text": {{ header_section }}
}
{%- if split_content.size > 1 -%},{%- endif -%}

{%- comment -%}Then deal with h2 sections {%- endcomment -%}
{%- for section in split_content offset:1 -%}
{%- assign section_id = section | split: 'id="' -%}
{%- assign section_id = section_id[1] | split: '">' -%}

{%- comment -%}Get section header{%- endcomment -%}
{%- assign section_header = section_id[1] | split: '</h2' -%}
{%- assign section_header = section_header[0] -%}

{%- comment -%}Get section id{%- endcomment -%}
{%- assign section_id = section_id[0] -%}
{%- comment -%}Get section url{%- endcomment -%}
{%- assign section_url = page_url | append: '#' | append: section_id -%}

{%- comment -%}Get section body{%- endcomment -%}
{%- assign full_section = '<h2 ' | append:section | strip_html | newline_to_br | strip_newlines | replace: '<br />', ' ' | strip | jsonify -%}
{
"title": "{{ section_header }}",
"url": "{{ section_url }}",
"text": {{ full_section }}
}
{%- unless forloop.last -%},{%- endunless -%}
        {%- endfor -%}
{%- unless forloop.last -%},{%- endunless -%}
    {%- endunless -%}
{%- endfor -%}
]